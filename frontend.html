<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Aura AI: Agent Core Chat UI</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white h-screen flex flex-col">
  <!-- Header -->
  <header class="bg-blue-700 p-4 text-xl font-bold">Aura AI Chat</header>

  <!-- Chat history -->
  <main id="chat-history" class="flex-1 overflow-y-auto p-4 space-y-3"></main>

  <!-- Input bar -->
  <footer class="p-4 bg-gray-800 flex">
    <input id="user-input" type="text" placeholder="Type a message..."
      class="flex-1 p-3 rounded-lg bg-gray-700 text-white outline-none"
      onkeypress="if(event.key==='Enter'){sendMessage();}">
    <button id="send-button"
      class="ml-2 px-4 py-2 bg-blue-600 rounded-lg hover:bg-blue-500"
      onclick="sendMessage()">Send</button>
  </footer>

  <script>
    const API_URL = "http://127.0.0.1:8000/chat"; // matches uvicorn backend
    let chatHistory = [];
    const chatHistoryEl = document.getElementById("chat-history");
    const userInputEl = document.getElementById("user-input");
    const sendButtonEl = document.getElementById("send-button");

    async function sendMessage() {
      const userMessage = userInputEl.value.trim();
      if (!userMessage) return;

      // Push user message into history
      chatHistory.push({ role: "user", text: userMessage });
      renderMessages();
      userInputEl.value = "";
      sendButtonEl.disabled = true;

      try {
        const response = await fetch(API_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ message: userMessage }),
        });

        if (!response.ok) {
          throw new Error(`Server error: ${response.status}`);
        }

        const result = await response.json();
        const reply = result.reply || "⚠️ No reply from server.";

        chatHistory.push({ role: "model", text: reply });
        renderMessages();
      } catch (err) {
        console.error("Error contacting backend:", err);
        chatHistory.push({ role: "model", text: "⚠️ Error contacting backend." });
        renderMessages();
      } finally {
        sendButtonEl.disabled = false;
        userInputEl.focus();
      }
    }

    function renderMessages() {
      chatHistoryEl.innerHTML = chatHistory.map(
        m => `
        <div class="flex ${m.role === "user" ? "justify-end" : "justify-start"}">
          <div class="p-3 rounded-xl max-w-xl ${
            m.role === "user"
              ? "bg-blue-600 text-white"
              : "bg-gray-700 text-gray-200"
          }">${m.text}</div>
        </div>`
      ).join("");
      chatHistoryEl.scrollTop = chatHistoryEl.scrollHeight;
    }
  </script>
</body>
</html>
